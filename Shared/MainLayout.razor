@using SEM.App.Authentication
@using Microsoft.AspNetCore.Components.Authorization

@inherits LayoutComponentBase

@inject AuthenticationStateProvider authenticationStateProvider
@inject HttpClient HttpClient

<PageTitle>Sport Event Manager</PageTitle>
	
	<div class="page">
		<NavMenu />
		<main>
			 <AuthorizeView>
				 <Authorized>
					 <div class="login-register-container">
						<a class="logout-button" @onclick="Logout" href="javascript:void(0)">Logout</a>
					 </div>
				 </Authorized>
				 <NotAuthorized>
					 <div class="login-register-container">
						 <a class="login-button" href="/login">Login</a>
						 <a class="register-button" href="/register">Register</a>
					 </div>
				 </NotAuthorized>
             </AuthorizeView>
			
			<article>
				@Body
			</article>
		</main>
	</div>

@code {
	protected override async Task OnInitializedAsync()
	{
		await HttpClient.GetAsync("https://sport-management-api.azurewebsites.net/hc");
		await base.OnInitializedAsync();
	}

	private async Task Logout()
	{
		var customAuthStateProvider = (CustomAuthenticationStateProvider) authenticationStateProvider;
		await customAuthStateProvider.UpdateAuthenticationState(null);
	}
}
